{"baseRefName":"main","body":"## What changed\nThis PR finalizes MVP recursive resolution behavior and docs clarity for non-`.dns` names.\n\nCode path already in branch/mainline includes:\n- recursive DoH adapter for ICANN domains\n- TTL-respecting local cache\n- stale-if-error fallback\n- prefetch near expiry\n- bounded eviction (`CACHE_MAX_ENTRIES`)\n\nThis PR update also adds explicit docs so readers understand:\n- `.dns` is handled by PKDNS\n- ICANN pass-through is recursive DoH + local TTL cache\n- ICANN answers are never written into canonical on-chain consensus\n- cache policy is MVP-only behavior (TTL/stale-if-error/prefetch)\n\n## Env vars + defaults\n\n| Variable | Default | Purpose |\n|---|---|---|\n| `UPSTREAM_DOH_URL` | `https://cloudflare-dns.com/dns-query` | Legacy single-upstream path. |\n| `UPSTREAM_DOH_URLS` | `https://cloudflare-dns.com/dns-query,https://dns.google/dns-query` | Recursive adapter upstream set. |\n| `CACHE_PATH` | `gateway/.cache/rrset.json` | Local cache file. |\n| `STALE_MAX_S` | `1800` | Max stale window served on upstream error. |\n| `PREFETCH_FRACTION` | `0.1` | Refresh threshold near TTL expiry. |\n| `CACHE_MAX_ENTRIES` | `50000` | Cache size cap before oldest eviction. |\n\n## Endpoints\n- `GET /v1/resolve?name=<domain>&type=A|AAAA`\n- `GET /v1/route?name=<domain>[&dest=<candidate>]`\n\nExamples:\n```bash\ncurl 'http://localhost:8054/v1/resolve?name=netflix.com&type=A'\ncurl 'http://localhost:8054/v1/resolve?name=example.dns&type=A'\n```\n\nExpected behavior:\n- `netflix.com` resolves through recursive adapter (`source: \"recursive\"`)\n- `example.dns` resolves through PKDNS path (`source: \"pkdns\"`)\n\n## Tests run\n```bash\nnpm -C packages/attack-mode run build\nnpm -C gateway test\nnpm -C gateway run build\n```\nResult summary:\n- attack-mode package build: PASS\n- gateway tests: PASS (8 files / 21 tests)\n- gateway TypeScript build: PASS\n\n## Security notes\n- No secrets/keypairs were added or committed.\n- Cache persistence is local file storage (`CACHE_PATH`) and should remain outside secret-bearing paths.\n- Upstream resolver privacy/trust is explicit: DoH providers are configurable; defaults are convenience providers (Cloudflare + Google). Operators should choose upstreams per privacy/compliance requirements.\n","commits":[{"authoredDate":"2026-02-18T09:35:23Z","authors":[{"email":"144741118+cwalinapj@users.noreply.github.com","id":"U_kgDOCKCS_g","login":"cwalinapj","name":"Paul Cwalina"}],"committedDate":"2026-02-18T09:35:23Z","messageBody":"","messageHeadline":"docs: clarify MVP PKDNS vs recursive ICANN behavior for gateway","oid":"d07ca3fc9c887272366c9c558553c83891c0b90d"}],"files":[{"path":"README.md","additions":8,"deletions":1},{"path":"gateway/README.md","additions":38,"deletions":18}],"headRefName":"codex/gateway-recursive-cache","labels":[],"number":65,"statusCheckRollup":[{"__typename":"CheckRun","completedAt":"2026-02-18T09:35:58Z","conclusion":"FAILURE","detailsUrl":"https://github.com/cwalinapj/DECENTRALIZED-DNS-/actions/runs/22134277208/job/63981846619","name":"Docs formatting (markdownlint)","startedAt":"2026-02-18T09:35:45Z","status":"COMPLETED","workflowName":"ci"},{"__typename":"CheckRun","completedAt":"2026-02-18T09:35:50Z","conclusion":"FAILURE","detailsUrl":"https://github.com/cwalinapj/DECENTRALIZED-DNS-/actions/runs/22134277208/job/63981846657","name":"Raspi TS package builds","startedAt":"2026-02-18T09:35:45Z","status":"COMPLETED","workflowName":"ci"},{"__typename":"CheckRun","completedAt":"2026-02-18T09:35:49Z","conclusion":"FAILURE","detailsUrl":"https://github.com/cwalinapj/DECENTRALIZED-DNS-/actions/runs/22134277208/job/63981846886","name":"Compat MVP validation","startedAt":"2026-02-18T09:35:45Z","status":"COMPLETED","workflowName":"ci"},{"__typename":"CheckRun","completedAt":"2026-02-18T09:35:52Z","conclusion":"FAILURE","detailsUrl":"https://github.com/cwalinapj/DECENTRALIZED-DNS-/actions/runs/22134277208/job/63981846637","name":"MVP resolver checks","startedAt":"2026-02-18T09:35:46Z","status":"COMPLETED","workflowName":"ci"},{"__typename":"CheckRun","completedAt":"2026-02-18T09:35:49Z","conclusion":"FAILURE","detailsUrl":"https://github.com/cwalinapj/DECENTRALIZED-DNS-/actions/runs/22134277208/job/63981846634","name":"MVP root tests","startedAt":"2026-02-18T09:35:45Z","status":"COMPLETED","workflowName":"ci"},{"__typename":"CheckRun","completedAt":"2026-02-18T09:35:42Z","conclusion":"SUCCESS","detailsUrl":"https://dashboard.gitguardian.com","name":"GitGuardian Security Checks","startedAt":"2026-02-18T09:35:41Z","status":"COMPLETED","workflowName":""}],"title":"gateway: recursive DoH adapter with TTL cache + stale-if-error","url":"https://github.com/cwalinapj/DECENTRALIZED-DNS-/pull/65"}
