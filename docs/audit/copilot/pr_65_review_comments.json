[{"url":"https://api.github.com/repos/cwalinapj/DECENTRALIZED-DNS-/pulls/comments/2821320250","pull_request_review_id":3818786855,"id":2821320250,"node_id":"PRRC_kwDORKbd9s6oKe46","diff_hunk":"@@ -1,35 +1,55 @@\n-# Resolver (Name Gateway MVP)\n+# Gateway Resolver (MVP)\n \n-This is the MVP name gateway service.\n+Resolver behavior is split by namespace:\n+\n+- `.dns` names are handled by **PKDNS** (Solana-backed path).\n+- Non-`.dns` ICANN names are handled by **recursive DoH** with local TTL cache.\n+- ICANN pass-through answers are never written into canonical on-chain consensus.\n+\n+Cache behavior for ICANN names:\n+\n+- TTL-respecting local cache (`qname:qtype` key)\n+- stale-if-error fallback\n+- prefetch near expiry\n+- bounded eviction when cache exceeds max entries\n \n ## Endpoints\n-- `GET /resolve?name=<domain>`\n+\n+- `GET /v1/resolve?name=<domain>&type=A|AAAA`\n+- `GET /v1/route?name=<domain>[&dest=<candidate>]`\n - `GET /healthz`\n \n-Response format:\n-```json\n-{\n-  \"name\": \"example.com\",\n-  \"network\": \"icann\",\n-  \"records\": [{ \"type\": \"A\", \"value\": \"203.0.113.10\", \"ttl\": 60 }],\n-  \"metadata\": { \"source\": \"doh\", \"cache\": \"miss\" }\n-}\n+Example:\n+\n+```bash\n+curl 'http://localhost:8054/v1/resolve?name=netflix.com&type=A'\n+curl 'http://localhost:8054/v1/resolve?name=example.dns&type=A'\n ```\n \n+## Env Vars (MVP)\n+\n+| Variable | Default | Notes |\n+|---|---|---|\n+| `UPSTREAM_DOH_URL` | `https://cloudflare-dns.com/dns-query` | Single-upstream default used by legacy paths. |\n+| `UPSTREAM_DOH_URLS` | `https://cloudflare-dns.com/dns-query,https://dns.google/dns-query` | Comma-separated upstream list used by recursive adapter. |\n+| `CACHE_PATH` | `gateway/.cache/rrset.json` | Local cache file path. |\n+| `STALE_MAX_S` | `1800` | Serve expired cache for up to this many seconds only on upstream error. |\n+| `PREFETCH_FRACTION` | `0.1` | Prefetch threshold: refresh when `time_left < max(5s, ttl*fraction)`. |\n+| `CACHE_MAX_ENTRIES` | `50000` | Max cache keys before oldest-entry eviction. |\n+| `REQUEST_TIMEOUT_MS` | `2000` | Upstream HTTP timeout. |\n+| `PORT` | `8054` | Gateway HTTP port. |\n+\n ## Run\n+\n ```bash\n-cd /Users/root1/dev/web3-repos/DECENTRALIZED-DNS-/resolver\n+cd /Users/root1/scripts/DECENTRALIZED-DNS-/gateway","path":"gateway/README.md","commit_id":"d07ca3fc9c887272366c9c558553c83891c0b90d","original_commit_id":"d07ca3fc9c887272366c9c558553c83891c0b90d","user":{"login":"Copilot","id":175728472,"node_id":"BOT_kgDOCnlnWA","avatar_url":"https://avatars.githubusercontent.com/in/946600?v=4","gravatar_id":"","url":"https://api.github.com/users/Copilot","html_url":"https://github.com/apps/copilot-pull-request-reviewer","followers_url":"https://api.github.com/users/Copilot/followers","following_url":"https://api.github.com/users/Copilot/following{/other_user}","gists_url":"https://api.github.com/users/Copilot/gists{/gist_id}","starred_url":"https://api.github.com/users/Copilot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Copilot/subscriptions","organizations_url":"https://api.github.com/users/Copilot/orgs","repos_url":"https://api.github.com/users/Copilot/repos","events_url":"https://api.github.com/users/Copilot/events{/privacy}","received_events_url":"https://api.github.com/users/Copilot/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"This line contains a hardcoded personal path that should be replaced with a generic relative path. Change this to just `cd gateway` or use a placeholder like `cd /path/to/DECENTRALIZED-DNS-/gateway`.\n```suggestion\ncd gateway\n```","created_at":"2026-02-18T09:39:53Z","updated_at":"2026-02-18T09:39:56Z","html_url":"https://github.com/cwalinapj/DECENTRALIZED-DNS-/pull/65#discussion_r2821320250","pull_request_url":"https://api.github.com/repos/cwalinapj/DECENTRALIZED-DNS-/pulls/65","_links":{"self":{"href":"https://api.github.com/repos/cwalinapj/DECENTRALIZED-DNS-/pulls/comments/2821320250"},"html":{"href":"https://github.com/cwalinapj/DECENTRALIZED-DNS-/pull/65#discussion_r2821320250"},"pull_request":{"href":"https://api.github.com/repos/cwalinapj/DECENTRALIZED-DNS-/pulls/65"}},"reactions":{"url":"https://api.github.com/repos/cwalinapj/DECENTRALIZED-DNS-/pulls/comments/2821320250/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":45,"original_line":45,"side":"RIGHT","author_association":"NONE","original_position":57,"position":57,"subject_type":"line"},{"url":"https://api.github.com/repos/cwalinapj/DECENTRALIZED-DNS-/pulls/comments/2821320275","pull_request_review_id":3818786855,"id":2821320275,"node_id":"PRRC_kwDORKbd9s6oKe5T","diff_hunk":"@@ -1,35 +1,55 @@\n-# Resolver (Name Gateway MVP)\n+# Gateway Resolver (MVP)\n \n-This is the MVP name gateway service.\n+Resolver behavior is split by namespace:\n+\n+- `.dns` names are handled by **PKDNS** (Solana-backed path).\n+- Non-`.dns` ICANN names are handled by **recursive DoH** with local TTL cache.\n+- ICANN pass-through answers are never written into canonical on-chain consensus.\n+\n+Cache behavior for ICANN names:\n+\n+- TTL-respecting local cache (`qname:qtype` key)\n+- stale-if-error fallback\n+- prefetch near expiry\n+- bounded eviction when cache exceeds max entries\n \n ## Endpoints\n-- `GET /resolve?name=<domain>`\n+\n+- `GET /v1/resolve?name=<domain>&type=A|AAAA`\n+- `GET /v1/route?name=<domain>[&dest=<candidate>]`\n - `GET /healthz`\n \n-Response format:\n-```json\n-{\n-  \"name\": \"example.com\",\n-  \"network\": \"icann\",\n-  \"records\": [{ \"type\": \"A\", \"value\": \"203.0.113.10\", \"ttl\": 60 }],\n-  \"metadata\": { \"source\": \"doh\", \"cache\": \"miss\" }\n-}\n+Example:\n+\n+```bash\n+curl 'http://localhost:8054/v1/resolve?name=netflix.com&type=A'\n+curl 'http://localhost:8054/v1/resolve?name=example.dns&type=A'\n ```\n \n+## Env Vars (MVP)\n+\n+| Variable | Default | Notes |\n+|---|---|---|\n+| `UPSTREAM_DOH_URL` | `https://cloudflare-dns.com/dns-query` | Single-upstream default used by legacy paths. |\n+| `UPSTREAM_DOH_URLS` | `https://cloudflare-dns.com/dns-query,https://dns.google/dns-query` | Comma-separated upstream list used by recursive adapter. |\n+| `CACHE_PATH` | `gateway/.cache/rrset.json` | Local cache file path. |\n+| `STALE_MAX_S` | `1800` | Serve expired cache for up to this many seconds only on upstream error. |\n+| `PREFETCH_FRACTION` | `0.1` | Prefetch threshold: refresh when `time_left < max(5s, ttl*fraction)`. |\n+| `CACHE_MAX_ENTRIES` | `50000` | Max cache keys before oldest-entry eviction. |\n+| `REQUEST_TIMEOUT_MS` | `2000` | Upstream HTTP timeout. |","path":"gateway/README.md","commit_id":"d07ca3fc9c887272366c9c558553c83891c0b90d","original_commit_id":"d07ca3fc9c887272366c9c558553c83891c0b90d","user":{"login":"Copilot","id":175728472,"node_id":"BOT_kgDOCnlnWA","avatar_url":"https://avatars.githubusercontent.com/in/946600?v=4","gravatar_id":"","url":"https://api.github.com/users/Copilot","html_url":"https://github.com/apps/copilot-pull-request-reviewer","followers_url":"https://api.github.com/users/Copilot/followers","following_url":"https://api.github.com/users/Copilot/following{/other_user}","gists_url":"https://api.github.com/users/Copilot/gists{/gist_id}","starred_url":"https://api.github.com/users/Copilot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Copilot/subscriptions","organizations_url":"https://api.github.com/users/Copilot/orgs","repos_url":"https://api.github.com/users/Copilot/repos","events_url":"https://api.github.com/users/Copilot/events{/privacy}","received_events_url":"https://api.github.com/users/Copilot/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"The default value for REQUEST_TIMEOUT_MS is incorrect. According to the code in gateway/src/server.ts line 36, the default is 5000, not 2000. Please update this value to 5000 to match the actual implementation.\n```suggestion\n| `REQUEST_TIMEOUT_MS` | `5000` | Upstream HTTP timeout. |\n```","created_at":"2026-02-18T09:39:54Z","updated_at":"2026-02-18T09:39:56Z","html_url":"https://github.com/cwalinapj/DECENTRALIZED-DNS-/pull/65#discussion_r2821320275","pull_request_url":"https://api.github.com/repos/cwalinapj/DECENTRALIZED-DNS-/pulls/65","_links":{"self":{"href":"https://api.github.com/repos/cwalinapj/DECENTRALIZED-DNS-/pulls/comments/2821320275"},"html":{"href":"https://github.com/cwalinapj/DECENTRALIZED-DNS-/pull/65#discussion_r2821320275"},"pull_request":{"href":"https://api.github.com/repos/cwalinapj/DECENTRALIZED-DNS-/pulls/65"}},"reactions":{"url":"https://api.github.com/repos/cwalinapj/DECENTRALIZED-DNS-/pulls/comments/2821320275/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":39,"original_line":39,"side":"RIGHT","author_association":"NONE","original_position":50,"position":50,"subject_type":"line"},{"url":"https://api.github.com/repos/cwalinapj/DECENTRALIZED-DNS-/pulls/comments/2821320302","pull_request_review_id":3818786855,"id":2821320302,"node_id":"PRRC_kwDORKbd9s6oKe5u","diff_hunk":"@@ -1,35 +1,55 @@\n-# Resolver (Name Gateway MVP)\n+# Gateway Resolver (MVP)\n \n-This is the MVP name gateway service.\n+Resolver behavior is split by namespace:\n+\n+- `.dns` names are handled by **PKDNS** (Solana-backed path).\n+- Non-`.dns` ICANN names are handled by **recursive DoH** with local TTL cache.\n+- ICANN pass-through answers are never written into canonical on-chain consensus.\n+\n+Cache behavior for ICANN names:\n+\n+- TTL-respecting local cache (`qname:qtype` key)\n+- stale-if-error fallback\n+- prefetch near expiry\n+- bounded eviction when cache exceeds max entries\n \n ## Endpoints\n-- `GET /resolve?name=<domain>`\n+\n+- `GET /v1/resolve?name=<domain>&type=A|AAAA`\n+- `GET /v1/route?name=<domain>[&dest=<candidate>]`\n - `GET /healthz`\n \n-Response format:\n-```json\n-{\n-  \"name\": \"example.com\",\n-  \"network\": \"icann\",\n-  \"records\": [{ \"type\": \"A\", \"value\": \"203.0.113.10\", \"ttl\": 60 }],\n-  \"metadata\": { \"source\": \"doh\", \"cache\": \"miss\" }\n-}\n+Example:\n+\n+```bash\n+curl 'http://localhost:8054/v1/resolve?name=netflix.com&type=A'\n+curl 'http://localhost:8054/v1/resolve?name=example.dns&type=A'\n ```\n \n+## Env Vars (MVP)\n+\n+| Variable | Default | Notes |\n+|---|---|---|\n+| `UPSTREAM_DOH_URL` | `https://cloudflare-dns.com/dns-query` | Single-upstream default used by legacy paths. |\n+| `UPSTREAM_DOH_URLS` | `https://cloudflare-dns.com/dns-query,https://dns.google/dns-query` | Comma-separated upstream list used by recursive adapter. |\n+| `CACHE_PATH` | `gateway/.cache/rrset.json` | Local cache file path. |\n+| `STALE_MAX_S` | `1800` | Serve expired cache for up to this many seconds only on upstream error. |\n+| `PREFETCH_FRACTION` | `0.1` | Prefetch threshold: refresh when `time_left < max(5s, ttl*fraction)`. |\n+| `CACHE_MAX_ENTRIES` | `50000` | Max cache keys before oldest-entry eviction. |\n+| `REQUEST_TIMEOUT_MS` | `2000` | Upstream HTTP timeout. |\n+| `PORT` | `8054` | Gateway HTTP port. |\n+\n ## Run\n+\n ```bash\n-cd /Users/root1/dev/web3-repos/DECENTRALIZED-DNS-/resolver\n+cd /Users/root1/scripts/DECENTRALIZED-DNS-/gateway\n npm install\n npm run build\n-PORT=8054 npm start\n+PORT=8054 npm run dev","path":"gateway/README.md","commit_id":"d07ca3fc9c887272366c9c558553c83891c0b90d","original_commit_id":"d07ca3fc9c887272366c9c558553c83891c0b90d","user":{"login":"Copilot","id":175728472,"node_id":"BOT_kgDOCnlnWA","avatar_url":"https://avatars.githubusercontent.com/in/946600?v=4","gravatar_id":"","url":"https://api.github.com/users/Copilot","html_url":"https://github.com/apps/copilot-pull-request-reviewer","followers_url":"https://api.github.com/users/Copilot/followers","following_url":"https://api.github.com/users/Copilot/following{/other_user}","gists_url":"https://api.github.com/users/Copilot/gists{/gist_id}","starred_url":"https://api.github.com/users/Copilot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Copilot/subscriptions","organizations_url":"https://api.github.com/users/Copilot/orgs","repos_url":"https://api.github.com/users/Copilot/repos","events_url":"https://api.github.com/users/Copilot/events{/privacy}","received_events_url":"https://api.github.com/users/Copilot/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"The command `npm run dev` is invalid because there is no \"dev\" script defined in gateway/package.json. According to the package.json, the correct command is `npm start` (which runs `node dist/server.js`). Please change this to `npm start`.\n```suggestion\nPORT=8054 npm start\n```","created_at":"2026-02-18T09:39:54Z","updated_at":"2026-02-18T09:39:54Z","html_url":"https://github.com/cwalinapj/DECENTRALIZED-DNS-/pull/65#discussion_r2821320302","pull_request_url":"https://api.github.com/repos/cwalinapj/DECENTRALIZED-DNS-/pulls/65","_links":{"self":{"href":"https://api.github.com/repos/cwalinapj/DECENTRALIZED-DNS-/pulls/comments/2821320302"},"html":{"href":"https://github.com/cwalinapj/DECENTRALIZED-DNS-/pull/65#discussion_r2821320302"},"pull_request":{"href":"https://api.github.com/repos/cwalinapj/DECENTRALIZED-DNS-/pulls/65"}},"reactions":{"url":"https://api.github.com/repos/cwalinapj/DECENTRALIZED-DNS-/pulls/comments/2821320302/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":48,"original_line":48,"side":"RIGHT","author_association":"NONE","original_position":61,"position":61,"subject_type":"line"}]